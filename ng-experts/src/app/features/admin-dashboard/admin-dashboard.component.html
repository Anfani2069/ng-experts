<app-dashboard-layout [showSearch]="false">
  <div class="px-6 md:px-8 py-6 bg-heroBg">

    <!-- Welcome Card -->
    <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6 mb-6 relative overflow-hidden">
      <div class="relative z-10 flex items-center justify-between flex-wrap gap-4">
        <div>
          <h1 class="text-2xl font-bold text-white mb-1">Administration üõ°Ô∏è</h1>
          <p class="text-subtext text-sm">G√©rez les utilisateurs, v√©rifications et activit√© de la plateforme</p>
        </div>
        <div class="flex items-center gap-2">
          <span class="px-3 py-1.5 bg-purple-500/10 text-purple-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-purple-500/20">
            <i class="fa-solid fa-shield-halved mr-1"></i> Super Admin
          </span>
        </div>
      </div>
      <div class="absolute right-6 bottom-0 opacity-5">
        <i class="fa-solid fa-shield-halved text-8xl"></i>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex items-center gap-2 mb-6 overflow-x-auto pb-2">
      <button (click)="setTab('overview')"
        class="px-4 py-2 rounded-full text-[11px] font-bold uppercase tracking-widest transition whitespace-nowrap"
        [class]="activeTab() === 'overview' ? 'bg-primary text-white shadow-[0_0_15px_-3px_rgba(236,72,153,0.4)]' : 'bg-white/5 text-subtext hover:text-white hover:bg-white/10 border border-white/10'">
        <i class="fa-solid fa-chart-line mr-1.5"></i> Vue d'ensemble
      </button>
      <button (click)="setTab('experts')"
        class="px-4 py-2 rounded-full text-[11px] font-bold uppercase tracking-widest transition whitespace-nowrap"
        [class]="activeTab() === 'experts' ? 'bg-primary text-white shadow-[0_0_15px_-3px_rgba(236,72,153,0.4)]' : 'bg-white/5 text-subtext hover:text-white hover:bg-white/10 border border-white/10'">
        <i class="fa-solid fa-user-tie mr-1.5"></i> Experts
        @if (stats(); as s) {
          <span class="ml-1.5 bg-white/20 px-1.5 py-0.5 rounded-full text-[9px]">{{ s.totalExperts }}</span>
        }
      </button>
      <button (click)="setTab('recruiters')"
        class="px-4 py-2 rounded-full text-[11px] font-bold uppercase tracking-widest transition whitespace-nowrap"
        [class]="activeTab() === 'recruiters' ? 'bg-primary text-white shadow-[0_0_15px_-3px_rgba(236,72,153,0.4)]' : 'bg-white/5 text-subtext hover:text-white hover:bg-white/10 border border-white/10'">
        <i class="fa-solid fa-building mr-1.5"></i> Recruteurs
        @if (stats(); as s) {
          <span class="ml-1.5 bg-white/20 px-1.5 py-0.5 rounded-full text-[9px]">{{ s.totalRecruiters }}</span>
        }
      </button>
      <button (click)="setTab('proposals')"
        class="px-4 py-2 rounded-full text-[11px] font-bold uppercase tracking-widest transition whitespace-nowrap"
        [class]="activeTab() === 'proposals' ? 'bg-primary text-white shadow-[0_0_15px_-3px_rgba(236,72,153,0.4)]' : 'bg-white/5 text-subtext hover:text-white hover:bg-white/10 border border-white/10'">
        <i class="fa-solid fa-file-contract mr-1.5"></i> Propositions
        @if (stats(); as s) {
          <span class="ml-1.5 bg-white/20 px-1.5 py-0.5 rounded-full text-[9px]">{{ s.totalProposals }}</span>
        }
      </button>
    </div>

    <!-- Loading -->
    @if (isLoading()) {
      <div class="flex items-center justify-center py-20 text-subtext">
        <i class="fa-solid fa-circle-notch fa-spin text-3xl text-primary"></i>
      </div>
    } @else {

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: OVERVIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab() === 'overview') {

        <!-- Stats Cards -->
        @if (stats(); as s) {
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-5">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center">
                  <i class="fa-solid fa-users text-primary"></i>
                </div>
                <span class="text-[10px] text-subtext font-bold uppercase tracking-widest">Total Utilisateurs</span>
              </div>
              <p class="text-3xl font-black text-white">{{ s.totalUsers }}</p>
              <p class="text-xs text-subtext mt-1">{{ s.activeUsers }} actifs ‚Ä¢ {{ s.inactiveUsers }} inactifs</p>
            </div>

            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-5">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-user-tie text-blue-400"></i>
                </div>
                <span class="text-[10px] text-subtext font-bold uppercase tracking-widest">Experts</span>
              </div>
              <p class="text-3xl font-black text-white">{{ s.totalExperts }}</p>
              <p class="text-xs text-subtext mt-1">{{ s.verifiedExperts }} v√©rifi√©s ‚Ä¢ {{ s.pendingExperts }} en attente</p>
            </div>

            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-5">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-xl bg-green-500/10 border border-green-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-building text-green-400"></i>
                </div>
                <span class="text-[10px] text-subtext font-bold uppercase tracking-widest">Recruteurs</span>
              </div>
              <p class="text-3xl font-black text-white">{{ s.totalRecruiters }}</p>
            </div>

            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-5">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-xl bg-yellow-500/10 border border-yellow-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-file-contract text-yellow-400"></i>
                </div>
                <span class="text-[10px] text-subtext font-bold uppercase tracking-widest">Propositions</span>
              </div>
              <p class="text-3xl font-black text-white">{{ s.totalProposals }}</p>
              <p class="text-xs text-subtext mt-1">{{ s.acceptedProposals }} accept√©es ‚Ä¢ {{ s.completedProposals }} termin√©es</p>
            </div>
          </div>

          <!-- 2 cols: Signups chart + Verification -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

            <!-- Inscriptions r√©centes -->
            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
              <h3 class="font-bold text-base text-white mb-1">Inscriptions r√©centes</h3>
              <p class="text-subtext text-[11px] mb-5">6 derniers mois</p>
              <div class="admin-bar-chart">
                @for (item of s.recentSignups; track item.month) {
                  <div class="flex flex-col items-center flex-1 gap-1">
                    <span class="text-white text-xs font-bold">{{ item.count }}</span>
                    <div class="admin-bar bg-primary/60 w-full rounded-t"
                      [style.height.px]="(item.count / getMaxSignups()) * 100 || 4">
                    </div>
                    <span class="text-[9px] text-subtext uppercase tracking-widest mt-1">{{ item.month }}</span>
                  </div>
                }
              </div>
            </div>

            <!-- Statut v√©rification -->
            <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
              <h3 class="font-bold text-base text-white mb-1">V√©rification des experts</h3>
              <p class="text-subtext text-[11px] mb-5">R√©partition par statut</p>
              <div class="space-y-4">
                <div>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-green-400 font-medium"><i class="fa-solid fa-check-circle mr-1"></i> V√©rifi√©s</span>
                    <span class="text-white font-bold">{{ s.verifiedExperts }}</span>
                  </div>
                  <div class="w-full bg-white/5 rounded-full h-2">
                    <div class="bg-green-400 h-2 rounded-full transition-all duration-500"
                      [style.width.%]="s.totalExperts ? (s.verifiedExperts / s.totalExperts * 100) : 0"></div>
                  </div>
                </div>
                <div>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-yellow-400 font-medium"><i class="fa-solid fa-clock mr-1"></i> En attente</span>
                    <span class="text-white font-bold">{{ s.pendingExperts }}</span>
                  </div>
                  <div class="w-full bg-white/5 rounded-full h-2">
                    <div class="bg-yellow-400 h-2 rounded-full transition-all duration-500"
                      [style.width.%]="s.totalExperts ? (s.pendingExperts / s.totalExperts * 100) : 0"></div>
                  </div>
                </div>
                <div>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-red-400 font-medium"><i class="fa-solid fa-times-circle mr-1"></i> Rejet√©s</span>
                    <span class="text-white font-bold">{{ s.rejectedExperts }}</span>
                  </div>
                  <div class="w-full bg-white/5 rounded-full h-2">
                    <div class="bg-red-400 h-2 rounded-full transition-all duration-500"
                      [style.width.%]="s.totalExperts ? (s.rejectedExperts / s.totalExperts * 100) : 0"></div>
                  </div>
                </div>
              </div>

              @if (s.pendingExperts > 0) {
                <button (click)="setTab('experts'); setVerificationFilter('pending')"
                  class="mt-5 w-full py-2.5 bg-yellow-500/10 text-yellow-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-yellow-500/20 hover:bg-yellow-500/20 transition">
                  <i class="fa-solid fa-eye mr-1"></i> Voir les {{ s.pendingExperts }} en attente
                </button>
              }
            </div>
          </div>

          <!-- Activit√© r√©cente -->
          <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3 class="font-bold text-base text-white">Derniers inscrits</h3>
                <p class="text-subtext text-[11px] mt-0.5">Utilisateurs les plus r√©cents</p>
              </div>
            </div>
            <div class="space-y-3">
              @for (user of recentUsers(); track user.id) {
                <div class="flex items-center gap-3 p-3 rounded-xl bg-white/[0.03] border border-white/5 hover:border-primary/20 hover:bg-white/[0.06] transition-all">
                  <img [src]="user.avatar || 'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=EC4899&color=fff'"
                    class="w-10 h-10 rounded-full object-cover border border-white/10 shrink-0">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                      <h4 class="font-bold text-white text-sm truncate">{{ user.firstName }} {{ user.lastName }}</h4>
                      <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full"
                        [class]="user.role === 'expert' ? 'bg-blue-500/10 text-blue-400 border border-blue-500/20' : user.role === 'recruiter' ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-purple-500/10 text-purple-400 border border-purple-500/20'">
                        {{ user.role === 'expert' ? 'Expert' : user.role === 'recruiter' ? 'Recruteur' : 'Admin' }}
                      </span>
                    </div>
                    <p class="text-xs text-subtext truncate">{{ user.email }}</p>
                  </div>
                  <div class="text-right shrink-0">
                    @if (toDate(user.createdAt)) {
                      <p class="text-xs text-subtext">{{ toDate(user.createdAt) | date:'dd MMM yyyy' }}</p>
                    }
                    <span class="text-[10px] font-bold uppercase tracking-widest"
                      [class]="user.isActive ? 'text-green-400' : 'text-red-400'">
                      {{ user.isActive ? 'Actif' : 'Inactif' }}
                    </span>
                  </div>
                  <button (click)="viewUserDetail(user)"
                    class="px-3 py-1.5 bg-white/5 border border-white/10 text-subtext text-[10px] font-bold uppercase tracking-widest rounded-full hover:border-primary/30 hover:text-primary transition">
                    D√©tails
                  </button>
                </div>
              }
            </div>
          </div>
        }
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: EXPERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab() === 'experts') {
        <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
            <div>
              <h3 class="font-bold text-base text-white">Gestion des Experts</h3>
              <p class="text-subtext text-[11px] mt-0.5">{{ filteredExperts().length }} expert(s) trouv√©(s)</p>
            </div>
          </div>

          <!-- Barre de recherche + Filtres -->
          <div class="flex items-center gap-3 mb-4 flex-wrap">
            <div class="relative flex-1 min-w-[200px]">
              <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-subtext text-xs"></i>
              <input type="text" placeholder="Nom, email, ville..."
                [value]="searchQuery()" (input)="onSearch($event)"
                class="w-full pl-9 pr-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder:text-subtext focus:outline-none focus:border-primary/50 transition">
            </div>
            <div class="flex gap-2">
              @for (f of ['all', 'pending', 'verified', 'rejected']; track f) {
                <button (click)="setVerificationFilter($any(f))"
                  class="px-3 py-2 rounded-lg text-[10px] font-bold uppercase tracking-widest transition"
                  [class]="verificationFilter() === f ? 'bg-primary/20 text-primary border border-primary/30' : 'bg-white/5 text-subtext border border-white/10 hover:border-primary/20'">
                  {{ f === 'all' ? 'Tous' : f === 'pending' ? 'En attente' : f === 'verified' ? 'V√©rifi√©s' : 'Rejet√©s' }}
                </button>
              }
            </div>
          </div>

          <!-- Liste experts -->
          <div class="space-y-3 max-h-[600px] overflow-y-auto pr-1">
            @if (filteredExperts().length === 0) {
              <div class="text-center py-12 text-subtext">
                <i class="fa-solid fa-user-slash text-3xl mb-3 opacity-20 block"></i>
                <p class="text-sm">Aucun expert trouv√©</p>
              </div>
            }
            @for (expert of filteredExperts(); track expert.id) {
              <div class="p-4 rounded-xl bg-white/[0.03] border border-white/5 hover:border-primary/20 hover:bg-white/[0.06] transition-all">
                <div class="flex items-center gap-4">
                  <img [src]="expert.avatar || 'https://ui-avatars.com/api/?name=' + expert.firstName + '+' + expert.lastName + '&background=EC4899&color=fff'"
                    class="w-12 h-12 rounded-full object-cover border border-white/10 shrink-0">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-0.5">
                      <h4 class="font-bold text-white text-sm">{{ expert.firstName }} {{ expert.lastName }}</h4>
                      <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full"
                        [class]="getVerificationClass(expert.verificationStatus)">
                        {{ getVerificationLabel(expert.verificationStatus) }}
                      </span>
                      @if (!expert.isActive) {
                        <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full bg-red-500/10 text-red-400 border border-red-500/20">D√©sactiv√©</span>
                      }
                    </div>
                    <p class="text-xs text-subtext">{{ expert.email }} ‚Ä¢ {{ expert.city || 'N/A' }}</p>
                    <div class="flex gap-1 flex-wrap mt-1.5">
                      @for (skill of (expert.skills || []).slice(0, 4); track skill.id) {
                        <span class="px-2 py-0.5 bg-primary/10 text-primary text-[10px] font-medium rounded-full border border-primary/20">{{ skill.name }}</span>
                      }
                      @if ((expert.skills || []).length > 4) {
                        <span class="px-2 py-0.5 bg-white/5 text-subtext text-[10px] rounded-full border border-white/10">+{{ expert.skills.length - 4 }}</span>
                      }
                    </div>
                  </div>
                  <div class="flex items-center gap-2 shrink-0">
                    @if (expert.verificationStatus === 'pending') {
                      <button (click)="verifyExpert(expert.id)"
                        class="px-3 py-1.5 bg-green-500/10 text-green-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-green-500/20 hover:bg-green-500/20 transition"
                        title="V√©rifier">
                        <i class="fa-solid fa-check mr-1"></i> V√©rifier
                      </button>
                      <button (click)="rejectExpert(expert.id)"
                        class="px-3 py-1.5 bg-red-500/10 text-red-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-red-500/20 hover:bg-red-500/20 transition"
                        title="Rejeter">
                        <i class="fa-solid fa-times mr-1"></i> Rejeter
                      </button>
                    }
                    @if (expert.verificationStatus === 'verified') {
                      <button (click)="resetToPending(expert.id)"
                        class="px-3 py-1.5 bg-yellow-500/10 text-yellow-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-yellow-500/20 hover:bg-yellow-500/20 transition"
                        title="Remettre en attente">
                        <i class="fa-solid fa-rotate-left mr-1"></i> R√©initialiser
                      </button>
                    }
                    @if (expert.verificationStatus === 'rejected') {
                      <button (click)="verifyExpert(expert.id)"
                        class="px-3 py-1.5 bg-green-500/10 text-green-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-green-500/20 hover:bg-green-500/20 transition"
                        title="V√©rifier quand m√™me">
                        <i class="fa-solid fa-check mr-1"></i> V√©rifier
                      </button>
                    }
                    <button (click)="toggleActive(expert.id, expert.isActive)"
                      class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest rounded-full transition"
                      [class]="expert.isActive ? 'bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/20' : 'bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20'">
                      {{ expert.isActive ? 'D√©sactiver' : 'Activer' }}
                    </button>
                    <button (click)="viewExpertProfile(expert.id)"
                      class="px-3 py-1.5 bg-white/5 border border-white/10 text-subtext text-[10px] font-bold uppercase tracking-widest rounded-full hover:border-primary/30 hover:text-primary transition">
                      <i class="fa-solid fa-eye"></i>
                    </button>
                    <button (click)="openDeleteConfirm(expert.id, expert.firstName + ' ' + expert.lastName)"
                      class="px-3 py-1.5 bg-red-500/10 text-red-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-red-500/20 hover:bg-red-500/20 transition">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: RECRUITERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab() === 'recruiters') {
        <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="font-bold text-base text-white">Gestion des Recruteurs</h3>
              <p class="text-subtext text-[11px] mt-0.5">{{ filteredRecruiters().length }} recruteur(s)</p>
            </div>
          </div>

          <!-- Recherche -->
          <div class="relative mb-4">
            <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-subtext text-xs"></i>
            <input type="text" placeholder="Nom, email, entreprise..."
              [value]="searchQuery()" (input)="onSearch($event)"
              class="w-full pl-9 pr-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder:text-subtext focus:outline-none focus:border-primary/50 transition">
          </div>

          <!-- Liste recruteurs -->
          <div class="space-y-3 max-h-[600px] overflow-y-auto pr-1">
            @if (filteredRecruiters().length === 0) {
              <div class="text-center py-12 text-subtext">
                <i class="fa-solid fa-building text-3xl mb-3 opacity-20 block"></i>
                <p class="text-sm">Aucun recruteur trouv√©</p>
              </div>
            }
            @for (recruiter of filteredRecruiters(); track recruiter.id) {
              <div class="p-4 rounded-xl bg-white/[0.03] border border-white/5 hover:border-primary/20 hover:bg-white/[0.06] transition-all">
                <div class="flex items-center gap-4">
                  <img [src]="recruiter.avatar || 'https://ui-avatars.com/api/?name=' + recruiter.firstName + '+' + recruiter.lastName + '&background=EC4899&color=fff'"
                    class="w-12 h-12 rounded-full object-cover border border-white/10 shrink-0">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-0.5">
                      <h4 class="font-bold text-white text-sm">{{ recruiter.firstName }} {{ recruiter.lastName }}</h4>
                      @if (!recruiter.isActive) {
                        <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full bg-red-500/10 text-red-400 border border-red-500/20">D√©sactiv√©</span>
                      }
                    </div>
                    <p class="text-xs text-subtext">{{ recruiter.email }}</p>
                    <p class="text-xs text-subtext mt-0.5">
                      <i class="fa-solid fa-building mr-1"></i>{{ recruiter.company || 'N/A' }}
                      @if (recruiter.location) {
                        <span class="ml-2"><i class="fa-solid fa-location-dot mr-1"></i>{{ recruiter.location }}</span>
                      }
                    </p>
                  </div>
                  <div class="flex items-center gap-2 shrink-0">
                    <button (click)="toggleActive(recruiter.id, recruiter.isActive)"
                      class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest rounded-full transition"
                      [class]="recruiter.isActive ? 'bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/20' : 'bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20'">
                      {{ recruiter.isActive ? 'D√©sactiver' : 'Activer' }}
                    </button>
                    <button (click)="viewUserDetail(recruiter)"
                      class="px-3 py-1.5 bg-white/5 border border-white/10 text-subtext text-[10px] font-bold uppercase tracking-widest rounded-full hover:border-primary/30 hover:text-primary transition">
                      <i class="fa-solid fa-eye"></i>
                    </button>
                    <button (click)="openDeleteConfirm(recruiter.id, recruiter.firstName + ' ' + recruiter.lastName)"
                      class="px-3 py-1.5 bg-red-500/10 text-red-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-red-500/20 hover:bg-red-500/20 transition">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: PROPOSALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab() === 'proposals') {
        <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="font-bold text-base text-white">Toutes les Propositions</h3>
              <p class="text-subtext text-[11px] mt-0.5">{{ filteredProposals().length }} proposition(s)</p>
            </div>
          </div>

          <!-- Recherche -->
          <div class="relative mb-4">
            <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-subtext text-xs"></i>
            <input type="text" placeholder="Titre, email recruteur..."
              [value]="searchQuery()" (input)="onSearch($event)"
              class="w-full pl-9 pr-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder:text-subtext focus:outline-none focus:border-primary/50 transition">
          </div>

          <!-- Liste propositions -->
          <div class="space-y-3 max-h-[600px] overflow-y-auto pr-1">
            @if (filteredProposals().length === 0) {
              <div class="text-center py-12 text-subtext">
                <i class="fa-solid fa-file-contract text-3xl mb-3 opacity-20 block"></i>
                <p class="text-sm">Aucune proposition trouv√©e</p>
              </div>
            }
            @for (proposal of filteredProposals(); track proposal.id) {
              <div class="p-4 rounded-xl border transition-all"
                [ngClass]="{
                  'border-green-500/20 bg-green-500/5': proposal.status === 'accepted',
                  'border-blue-500/20 bg-blue-500/5': proposal.status === 'completed',
                  'border-white/5 bg-white/[0.03]': proposal.status === 'pending',
                  'border-white/5 bg-white/[0.02] opacity-60': proposal.status === 'rejected'
                }">
                <div class="flex items-start justify-between gap-2 mb-2">
                  <h4 class="font-bold text-white text-sm leading-tight">{{ proposal.title }}</h4>
                  <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-full shrink-0"
                    [class]="getProposalStatusClass(proposal.status)">
                    {{ getProposalStatusLabel(proposal.status) }}
                  </span>
                </div>
                <div class="flex items-center gap-3 flex-wrap">
                  <span class="text-primary font-bold text-sm">{{ proposal.budget }}</span>
                  <span class="text-white/20 text-xs">‚Ä¢</span>
                  <span class="text-subtext text-xs">
                    <i class="fa-solid fa-user mr-1"></i>Recruteur: {{ getUserNameById(proposal.clientId || '') }}
                  </span>
                  <span class="text-white/20 text-xs">‚Ä¢</span>
                  <span class="text-subtext text-xs">
                    <i class="fa-solid fa-user-tie mr-1"></i>Expert: {{ getUserNameById(proposal.expertId) }}
                  </span>
                  @if (toDate(proposal.createdAt)) {
                    <span class="text-white/20 text-xs">‚Ä¢</span>
                    <span class="text-subtext text-xs">{{ toDate(proposal.createdAt) | date:'dd MMM yyyy' }}</span>
                  }
                </div>
                <p class="text-xs text-subtext mt-2 line-clamp-2">{{ proposal.description }}</p>
              </div>
            }
          </div>
        </div>
      }
    }
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL CONFIRMATION SUPPRESSION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  @if (showConfirmModal()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="cancelConfirm()"></div>
      <div class="bg-[#1a1a1a] border border-white/10 rounded-2xl w-full max-w-md relative z-10 p-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-500/10 border border-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa-solid fa-trash text-red-400 text-2xl"></i>
          </div>
          <h3 class="text-lg font-bold text-white mb-2">Confirmer la suppression</h3>
          <p class="text-subtext text-sm mb-6">
            √ätes-vous s√ªr de vouloir supprimer <strong class="text-white">{{ confirmAction()?.userName }}</strong> ?
            Cette action est irr√©versible.
          </p>
          <div class="flex gap-3">
            <button (click)="cancelConfirm()"
              class="flex-1 py-2.5 bg-white/5 border border-white/10 text-subtext text-[11px] font-bold uppercase tracking-widest rounded-full hover:bg-white/10 transition">
              Annuler
            </button>
            <button (click)="confirmDelete()"
              class="flex-1 py-2.5 bg-red-500 text-white text-[11px] font-bold uppercase tracking-widest rounded-full hover:bg-red-600 transition shadow-[0_0_20px_-5px_rgba(239,68,68,0.5)]">
              <i class="fa-solid fa-trash mr-1"></i> Supprimer
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL D√âTAIL UTILISATEUR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  @if (showUserDetail() && selectedUser(); as user) {
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="closeUserDetail()"></div>
      <div class="bg-[#1a1a1a] border border-white/10 rounded-2xl w-full max-w-lg relative z-10 overflow-hidden max-h-[80vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-white">D√©tails utilisateur</h3>
            <button (click)="closeUserDetail()" class="w-8 h-8 rounded-lg hover:bg-white/5 flex items-center justify-center transition">
              <i class="fa-solid fa-times text-subtext"></i>
            </button>
          </div>

          <!-- Avatar & Nom -->
          <div class="text-center mb-6 pb-6 border-b border-white/5">
            <img [src]="user.avatar || 'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=EC4899&color=fff'"
              class="w-20 h-20 rounded-full mx-auto mb-3 border-4 border-primary/20 object-cover">
            <h4 class="font-bold text-lg text-white mb-1">{{ user.firstName }} {{ user.lastName }}</h4>
            <span class="text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full"
              [class]="user.role === 'expert' ? 'bg-blue-500/10 text-blue-400 border border-blue-500/20' : user.role === 'recruiter' ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-purple-500/10 text-purple-400 border border-purple-500/20'">
              {{ user.role === 'expert' ? 'Expert' : user.role === 'recruiter' ? 'Recruteur' : 'Admin' }}
            </span>
          </div>

          <!-- Infos -->
          <div class="space-y-3">
            <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
              <i class="fa-solid fa-envelope text-subtext w-5"></i>
              <div>
                <p class="text-[10px] text-subtext uppercase tracking-widest">Email</p>
                <p class="text-sm text-white">{{ user.email }}</p>
              </div>
            </div>

            <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
              <i class="fa-solid fa-toggle-on text-subtext w-5"></i>
              <div>
                <p class="text-[10px] text-subtext uppercase tracking-widest">Statut</p>
                <p class="text-sm" [class]="user.isActive ? 'text-green-400' : 'text-red-400'">
                  {{ user.isActive ? 'Actif' : 'D√©sactiv√©' }}
                </p>
              </div>
            </div>

            @if (toDate(user.createdAt)) {
              <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
                <i class="fa-solid fa-calendar text-subtext w-5"></i>
                <div>
                  <p class="text-[10px] text-subtext uppercase tracking-widest">Inscrit le</p>
                  <p class="text-sm text-white">{{ toDate(user.createdAt) | date:'dd MMMM yyyy √† HH:mm' }}</p>
                </div>
              </div>
            }

            @if (user.role === 'expert') {
              <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
                <i class="fa-solid fa-shield-check text-subtext w-5"></i>
                <div>
                  <p class="text-[10px] text-subtext uppercase tracking-widest">V√©rification</p>
                  <span class="text-[11px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full"
                    [class]="getVerificationClass(asExpert(user).verificationStatus)">
                    {{ getVerificationLabel(asExpert(user).verificationStatus) }}
                  </span>
                </div>
              </div>

              @if (asExpert(user).city) {
                <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
                  <i class="fa-solid fa-location-dot text-subtext w-5"></i>
                  <div>
                    <p class="text-[10px] text-subtext uppercase tracking-widest">Ville</p>
                    <p class="text-sm text-white">{{ asExpert(user).city }}</p>
                  </div>
                </div>
              }

              @if (asExpert(user).skills.length) {
                <div class="p-3 bg-white/[0.03] rounded-lg border border-white/5">
                  <p class="text-[10px] text-subtext uppercase tracking-widest mb-2"><i class="fa-solid fa-code mr-1"></i> Comp√©tences</p>
                  <div class="flex gap-1 flex-wrap">
                    @for (skill of asExpert(user).skills; track skill.id) {
                      <span class="px-2 py-0.5 bg-primary/10 text-primary text-[10px] font-medium rounded-full border border-primary/20">{{ skill.name }}</span>
                    }
                  </div>
                </div>
              }
            }

            @if (user.role === 'recruiter') {
              <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
                <i class="fa-solid fa-building text-subtext w-5"></i>
                <div>
                  <p class="text-[10px] text-subtext uppercase tracking-widest">Entreprise</p>
                  <p class="text-sm text-white">{{ asRecruiter(user).company }}</p>
                </div>
              </div>
              @if (asRecruiter(user).location) {
                <div class="flex items-center gap-3 p-3 bg-white/[0.03] rounded-lg border border-white/5">
                  <i class="fa-solid fa-location-dot text-subtext w-5"></i>
                  <div>
                    <p class="text-[10px] text-subtext uppercase tracking-widest">Localisation</p>
                    <p class="text-sm text-white">{{ asRecruiter(user).location }}</p>
                  </div>
                </div>
              }
            }
          </div>

          <!-- Actions -->
          <div class="mt-6 pt-6 border-t border-white/5 flex gap-3">
            @if (user.role === 'expert') {
              <button (click)="viewExpertProfile(user.id); closeUserDetail()"
                class="flex-1 py-2.5 bg-primary text-white text-[10px] font-bold uppercase tracking-widest rounded-full hover:bg-primary/80 transition">
                <i class="fa-solid fa-eye mr-1"></i> Voir le profil
              </button>
            }
            <button (click)="toggleActive(user.id, user.isActive); closeUserDetail()"
              class="flex-1 py-2.5 text-[10px] font-bold uppercase tracking-widest rounded-full transition"
              [class]="user.isActive ? 'bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/20' : 'bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20'">
              {{ user.isActive ? 'D√©sactiver' : 'Activer' }}
            </button>
            <button (click)="openDeleteConfirm(user.id, user.firstName + ' ' + user.lastName); closeUserDetail()"
              class="py-2.5 px-4 bg-red-500/10 text-red-400 text-[10px] font-bold uppercase tracking-widest rounded-full border border-red-500/20 hover:bg-red-500/20 transition">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</app-dashboard-layout>
